# Update Profile README with SVG Stats Card
#
# This workflow demonstrates how to automatically update a GitHub profile README
# with an SVG stats card generated by gogithub. Users can copy this workflow to
# their profile repository (username/username).
#
# Usage:
# 1. Copy this file to your profile repository's .github/workflows/ directory
# 2. Ensure the workflow has write permissions to your repository
# 3. Reference the generated SVG in your README.md: ![GitHub Stats](./stats.svg)
#
# For more information, see: https://github.com/grokify/gogithub/blob/main/docs/guides/profile-svg.md

name: Update Profile README

on:
  # Run weekly on Sunday at midnight UTC
  schedule:
    - cron: '0 0 * * 0'

  # Allow manual trigger from Actions tab
  workflow_dispatch:
    inputs:
      theme:
        description: 'SVG theme (default, dark, radical, tokyonight, gruvbox, dracula, nord, catppuccin)'
        required: false
        default: 'default'
      title:
        description: 'Custom card title (leave empty for default)'
        required: false
        default: ''

jobs:
  update-readme:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Go
        uses: actions/setup-go@v5
        with:
          go-version: '1.23'
          cache: true

      - name: Install gogithub
        run: go install github.com/grokify/gogithub/cmd/gogithub@latest

      - name: Generate Stats SVG
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          # Use workflow_dispatch inputs if available, otherwise use defaults
          THEME="${{ github.event.inputs.theme || 'default' }}"
          TITLE="${{ github.event.inputs.title }}"

          # Build the command
          CMD="gogithub profile --user ${{ github.repository_owner }} --output-svg stats.svg --svg-theme $THEME"

          # Add custom title if provided
          if [ -n "$TITLE" ]; then
            CMD="$CMD --svg-title \"$TITLE\""
          fi

          # Execute
          eval $CMD

      - name: Commit and Push
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

          # Check if there are changes to commit
          git add stats.svg
          if git diff --staged --quiet; then
            echo "No changes to commit"
            exit 0
          fi

          git commit -m "chore: update profile stats SVG

          Generated by gogithub profile command.
          Theme: ${{ github.event.inputs.theme || 'default' }}"

          git push
